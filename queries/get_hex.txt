brown brown A52A2A
brick red cb4154
pearl white eae0c8
purple purple 800080
gold yellow FFD700
black black 000000
golden yellow FFD700
dapple-gray gray acb4af
gray gray 808080
iron-gray gray 434b4d
red red FF0000
white white FFFFFF
rose pink FF007F
chestnut brown 954535
pink pink FFC0CB
ill-colored NULL NULL
silver gray C0C0C0
high-colored NULL NULL
greenish green 008000
yellow yellow FFFF00
blue blue 0000FF
blue-green blue 21B6A8
silver-gray gray 808080
coral red FF7F50
shadow gray 808080
purplish purple 800080
flaxen yellow f9da7f
gray-brown brown A52A2A
green green 008000
redden red FF0000
dead-white white FFFFFF
violet purple EE82EE
pearly white eae0c8
dove-colored white FFFFFF
maroon red 800000
mahogany brown 670A0A
copper brown b87333
dun gray DAC8AE
hazel green 594c26
blue-gray gray 6699cc
rosy red FF0000
whiten white FFFFFF
livid blue 6699cc
honey yellow FDD378
woolen-white white E8E8E8
lavender purple E6E6FA
brownish brown A52A2A
fresh-colored NULL NULL
blacken black 000000
cherry-colored red C40000
buff-colored NULL NULL
silvery white FFFFFF
cream white FCFBE3
crimson red DC143C
honey-colored yellow FDD378
jade green 00a86b
gilt yellow e3c84c
coal-black black 000000
ivory white fffff0
ebony black 555d50
scarlet red ff2400
rose-red red C21E56
rose-white white FFFEFE
fiery-colored NULL NULL
gilded yellow f0e682
olive-colored green bab86c
vermilion red e34234
bronze brown cd7f32
olive green bab86c
cream-colored white FCFBE3
apricot-colored orange FBCEB1
straw-colored yellow D6BF86
ginger red B06500
magenta purple ff00ff
agate brown ccc7bc
brightly-colored NULL NULL
cinnamon red D2691E
rose-colored red FF007F
jade-green green 00a86b
iris purple 5A4FCF
opal white AAC4C4
nacre-colored gray fbf4e2
sulphur-yellow yellow edff21
sanguine red 850505
mauve purple b784a7
pearl-colored white eae0c8
orchid purple da70d6
copper-green green 008000
olive-green green bab86c
milky white DCD9CD
pistachio-colored green 93c572
rose-pink pink FF66CC
wine-yellow yellow ffff00
flame-red red af2b1e
orange orange ffa500
ruby red E0115F
emerald green 50c878
turquoise blue 00e5ee
red-gold yellow ffff00
crocus-colored purple 9b81ba
tawny brown CC6600
amber-colored yellow FFBE00
amber yellow FFBE00
citron-green green 8FB31D
turquoise-blue blue 00E5EE
beryl green D6E3B5
platinum white E5E4E2
ochre-colored orange CC7722
bone white E1D4C0
charcoal gray 36454F
peach-colored orange FFCC99
strawberry red DE0914
dull-green green 4D994D
apricot orange FBCEB1
cherry red C40000
rich-brown brown 321A18
water-colored blue E0EAF4
bright-colored NULL NULL
light-colored NULL NULL
whitish-brown brown A05738
ruddy red FF0028
snow-white white FFFAFA
green-baize green C5D0A8
bluish blue 0000FF
lime green 99FF00
whitish white FFFFFF
yellowish yellow FFFF00
cream-color white  FFFFCC
primrose-colored yellow E6E99D
blackened-green green 002000
whitey-brown brown FAEBD7
wheat yellow F5DEB3
murrey-colored red 9A3B5D
arial-gray gray D3D3D3
russet red 80461B
Lead-colored gray 6D6A65
blacker black 000000
eel-brown brown 654321
reddish red FF0000
puce purple CC8899
plum purple 8E4585
blood-red red 8A0707
many-colored NULL NULL
whiter white FFFFFF
custard-colored yellow FFF5C9
auburn brown A52A2A
lead-color gray 6D6A65
lead-colored gray 6D6A65
rose-color red FFE4E1
canary-colored yellow FFEF00
coffee-colored brown 593C1F
oakum-colored gray DDDAE1
browner brown F4A460
rusty-black black 000000
copper-colored brown B87333
rust red B7410E
yellow-green green ADFF2F
red-brick brick 841F27
bluer blue 0000FF
damaged-orange orange FFA500
rubicund red FF8B74
sky-blue blue 7EC0EE
jet black 000000
canary yellow FFEF00
red-brown brown CB4154
greenest green 00FF00
rouge red FF0000
tan brown D2B48C
jet-black black 000000
mulberry-colored black 2A0A1f
grayer gray D3D3D3
lavender-colored purple B378D3
lemon yellow FFF44F
nut-brown brown 84683C
reddish-gray gray A49494
topaz yellow FFC87C
whity-brown brown FAEBD7
mouse-colored gray 808080
village-green green 6E7E64
roseate red F9E6DC
milk-white white DCD9CD
whitest white FFFFFF
amethyst purple 9966CC
redder red FF0000
marble-white white EDECEE
blackest black 000000
blue-black black 003366
navy blue 000080
lilac purple C8A2C8
tender-colored NULL NULL
gray-blue blue 778899
glass-green green 03BE73
alabaster white F9F9F9
gaily-colored NULL NULL
richest-colored NULL NULL
gold-colored yellow FFD700

import sqlite3
import math
import spectra
from colormath.color_objects import LabColor
from colormath.color_diff import delta_e_cie2000

conn = sqlite3.connect('../color_analysis_merged.db')
c = conn.cursor()

##f = open('get_hex.txt', 'w+')
##query = """SELECT distinct color.name, color.base
##FROM color, mention, sentence, clause, book WHERE mention.color=color.id AND
##mention.clause=clause.id AND clause.sentence=sentence.id AND sentence.book=book.id AND
##book.id IN (3759, 3694,5727, 4032, 4637, 2743, 5866, 1032, 5155, 2410)"""
##c.execute(query)
##for row in c.execute(query):
##    f.write(row[0] + ' ' + row[1] + '\n')
##
##f.close()

book_ids = [3759, 3694,5727, 4032, 4637, 2743, 5866, 1032, 5155, 2410]
# stores all color mentions for each book with id in book_ids
# format key: book id, value: (color name, color base, index of mention)
mentions = {}

# stores length of each book with id in book_ids
# format key: book id, value: length of book
book_lengths = {}

# stores lengths of each sentence for every book in in book_ids
# format key: book id, value: {sentence_id: length}
sentences = {}

# hex codes
hex_codes = {}
for color in open('get_hex.txt', 'r'):
    color = color.split(' ')
    hex_codes[color[0]] = color[2].strip('\n').upper()

# get sentence lengths
for id in book_ids:
    sentences[id] = {}
    mentions[id] = []
    c.execute("""SELECT index_in_book, length FROM sentence where book=?""", [id])
    for row in c.fetchall():
        sentences[id][row[0]] = row[1]

    book_lengths[id] = sum(sentences[id])


# index of last word before sentence containing mention
def get_index_mention(book, sentence):
    result = 0
    for i in range(sentence - 1):
        result += sentences[book][i]
    return 0

# populate mentions dict
query = """SELECT sentence.index_in_book, color.name, color.base, book.id, mention.index_in_sent
FROM color, mention, sentence, clause, book WHERE mention.color=color.id AND
mention.clause=clause.id AND clause.sentence=sentence.id AND sentence.book=book.id AND
book.id IN (3759, 3694,5727, 4032, 4637, 2743, 5866, 1032, 5155, 2410)"""
c.execute(query)
for row in c.fetchall():
    sentence_index = row[0]
    mention_index = row[4] # in sentence
    color_name = row[1]
    color_base = row[2]
    book_id = row[3]

    if hex_codes[color_name] != 'NULL':
        mention_index_in_book = get_index_mention(book_id, sentence_index)
        
        mentions[book_id].append((color_name, color_base,
                                  mention_index_in_book + mention_index, hex_codes[color_name]))
    

# dynamic time warping
def d(a, b):
    lab0 = spectra.html(a[3]).to('lab').values
    lab1 = spectra.html(a[3]).to('lab').values

    lab0 = LabColor(lab_l=lab0[0], lab_a=lab0[1], lab_b=lab0[2])
    lab1 = LabColor(lab_l=lab1[0], lab_a=lab1[1], lab_b=lab1[2])
    
    return abs(a[2] - b[2]) * delta_e_cie2000(lab0, lab1)   

def dtw_distance(s, t):
    DTW = []
    for x in s:
        DTW.append([0 for x in t])

    for i in range(len(s)):
        DTW[i][0] = math.inf
    for i in range(len(t)):
        DTW[0][i] = math.inf

    DTW[0][0] = 0

    for i in range(len(s)):
        for j in range(len(t)):
            cost = d(s[i], t[j])
            DTW[i][j] = cost + min(min(DTW[i-1][j], DTW[i][j-1]), DTW[i - 1][j -1])

    return DTW[len(s) - 1][len(t) - 1]

matrix = []
for x in mentions:
    matrix.append([0 for x in mentions])

a = 0
b = 0
for i in mentions:
    for j in mentions:
        matrix[a][b] = dtw_distance(mentions[i], mentions[j])
        b += 1
    a += 1
    b = 0

options = []
